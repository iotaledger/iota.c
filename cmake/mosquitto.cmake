#[[
// Copyright 2021 IOTA Stiftung
// SPDX-License-Identifier: Apache-2.0
]]

if (NOT __MOSQUITTO_INCLUDED)
  set(__MOSQUITTO_INCLUDED TRUE)

  ExternalProject_Add(
    ext_mosquitto
    PREFIX ${PROJECT_BINARY_DIR}/mosquitto
    DOWNLOAD_DIR ${PROJECT_BINARY_DIR}/download
    DOWNLOAD_NAME mosquitto_v2.0.14.tar.gz
    URL https://github.com/eclipse/mosquitto/archive/v2.0.14.tar.gz
    URL_HASH SHA256=c0ce97b1911d1769ccfd65da237e919fd7eaa60209fd190c113d63fbd0c40347
    BUILD_IN_SOURCE TRUE
    CMAKE_ARGS
    -DWITH_CJSON:STRING=OFF
    -DWITH_TLS:STRING=OFF
    -DWITH_STATIC_LIBRARIES:STRING=ON
    -DWITH_THREADING:STRING=ON
    -DWITH_CLIENTS:STRING=OFF
    -DWITH_BROKER:STRING=OFF
    -DWITH_APPS:STRING=OFF
    -DWITH_PLUGINS:STRING=OFF
    -DDOCUMENTATION:STRING=OFF
    -DCMAKE_INSTALL_PREFIX:STRING=${CMAKE_INSTALL_PREFIX}
    -DCMAKE_C_COMPILER:FILEPATH=${CMAKE_C_COMPILER}
    -DCMAKE_BUILD_TYPE:STRING=${CMAKE_BUILD_TYPE}
    # for debug
    # LOG_DOWNLOAD 1
    # LOG_CONFIGURE 1
    # LOG_INSTALL 1
  )

endif()
